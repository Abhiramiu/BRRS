<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-4.dtd">

<!--
CREATED BY	: PRASANTH M
CREATED ON	: 29.09.2025
PURPOSE		: Referance Code Master
 -->

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />

	<!-- CSS (Bootstrap, FontAwesome, jQuery UI, DataTables) -->

	<link rel="stylesheet" type="text/css" href="/webjars/bootstrap/4.3.1/css/bootstrap.min.css"
		th:href="@{/webjars/bootstrap/4.3.1/css/bootstrap.min.css}" />

	<link rel="stylesheet" type="text/css" href="/webjars/font-awesome/5.9.0/css/all.min.css"
		th:href="@{/webjars/font-awesome/5.9.0/css/all.min.css}" />

	<link rel="stylesheet" type="text/css" href="/webjars/jquery-ui/1.12.1/jquery-ui.min.css"
		th:href="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.css}" />

	<link rel="stylesheet" type="text/css" href="/webjars/datatables/1.10.19/css/jquery.dataTables.min.css"
		th:href="@{/webjars/datatables/1.10.19/css/jquery.dataTables.min.css}" />

	<link rel="stylesheet" th:href="@{/css/CustomButton.css}" />

	<script src="https://cdn.jsdelivr.net/jquery.validation/1.19.5/jquery.validate.min.js"></script>

	<!-- Favicon -->

	<link rel="shortcut icon" type="image/x-icon" th:href="@{/favicon.ico}" />
	<link rel="icon" type="image/x-xicon" th:href="@{/favicon.ico}" />

	<!-- JavaScript: jQuery must come first -->

	<script src="/webjars/jquery/3.4.1/jquery.min.js" th:src="@{/webjars/jquery/3.4.1/jquery.min.js}"></script>

	<script src="/webjars/jquery-ui/1.12.1/jquery-ui.min.js"
		th:src="@{/webjars/jquery-ui/1.12.1/jquery-ui.min.js}"></script>

	<script src="/webjars/popper.js/1.14.7/umd/popper.min.js"
		th:src="@{/webjars/popper.js/1.14.7/umd/popper.min.js}"></script>

	<script src="/webjars/bootstrap/4.3.1/js/bootstrap.min.js"
		th:src="@{/webjars/bootstrap/4.3.1/js/bootstrap.min.js}"></script>

	<script src="/webjars/jquery-validation/1.19.0/jquery.validate.min.js"
		th:src="@{/webjars/jquery-validation/1.19.0/jquery.validate.min.js}"></script>

	<script src="/webjars/jquery-form/4.2.2/jquery.form.min.js"
		th:src="@{/webjars/jquery-form/4.2.2/jquery.form.min.js}"></script>

	<script src="/webjars/datatables/1.10.19/js/jquery.dataTables.min.js"
		th:src="@{/webjars/datatables/1.10.19/js/jquery.dataTables.min.js}"></script>

	<script src="/webjars/datatables/1.10.19/js/dataTables.bootstrap4.min.js"
		th:src="@{/webjars/datatables/1.10.19/js/dataTables.bootstrap4.min.js}"></script>

	<style>
		.btns {
			float: right;
			margin: 5px;
		}

		.col-sm-5 {
			padding-bottom: 15px;
		}

		.list-body {
			padding: 0px;
		}

		.error {
			color: red;
			padding-left: 10px;
		}

		.formline {
			padding-bottom: 15px;
		}

		.btn-primary {
			background-color: #E77400;
			border-color: #0c0c0c;
		}

		#finusertb {
			width: 460px;
		}

		.dataTables_wrapper .dataTables_paginate .paginate_button {
			padding: 0px;
		}

		.valids {
			color: green;
		}

		.invalids {
			color: red;
		}

		.error {
			color: red !important;
		}
	</style>

	<style>
		/* Make table fully responsive */
		.table-container {
			width: 100%;
			overflow-x: auto;
		}

		/* Table cell styling */
		#usertable th,
		#usertable td {
			vertical-align: middle;
			text-align: left;
			font-size: 16px;
			padding: 8px 10px;
		}

		/* Icon styling */
		.action-icon {
			font-size: 16px;
			cursor: pointer;
			margin-right: 10px;
			transition: transform 0.2s, color 0.2s;
		}

		.action-icon:hover {
			transform: scale(1.2);
		}

		/* Specific colors */
		.action-icon.modify {
			color: blue;
		}

		.action-icon.view {
			color: green;
		}

		.action-icon.delete {
			color: red;
		}

		.action-icon.verify {
			color: orange;
		}

		/* Ensure word break for long menu lists */
		#usertable td {
			word-break: break-word;
		}
	</style>

	<script th:inline="javascript">


		function home() {
			location.href = 'Dashboard'
		}

		function back() {
			window.history.back();
		}

		// Function to load data based on selected report code
		function loadReportData(reportCode) {
		    console.log("loadReportData called with reportCode:", reportCode);

		    if (!reportCode) {
		        console.log("No report code selected. Clearing table.");
		        $('#usertable tbody').empty(); // Clear table if no report code is selected
		        return;
		    }

		    $.ajax({
		        url: '/BRRS/Reports/getReportDataByCode', 
		        type: 'GET',
		        data: { reportCode: reportCode.replace('-', '_') },
		        beforeSend: function(xhr) {
		            console.log("AJAX beforeSend: preparing request for reportCode =", reportCode);
		        },
		        success: function(data, textStatus, xhr) {
		            console.log("AJAX success!", data);
		            populateTable(data); 
		        },
		        error: function(xhr, status, error) {
		            console.error("AJAX error!", status, error);
		        },
		        complete: function(xhr, status) {
		            console.log("AJAX complete. Status:", status);
		        }
		    });
		}


		function populateTable(data) {
			const tbody = $('#usertable tbody');
			tbody.empty(); // Clear existing rows

			if (data && data.length > 0) {
				data.forEach((item, index) => {
					// Extract the row number from the product field (e.g., R11, R12)
					const rowNumberMatch = item.reportLabel ? item.reportLabel.match(/R(\d+)/) : null;
					const rowNum = rowNumberMatch ? rowNumberMatch[1] : '';

					let tr = `<tr>
							<td>${index + 1}</td>
							<td>${item.fieldDescription || ''}</td>
							<td>${item.reportLabel || ''}</td>
							<td>${item.header || ''}</td>
							<td>${item.remarks || ''}</td>
						</tr>`;
					tbody.append(tr);
				});
			} else {
				tbody.append('<tr><td colspan="5">No data available for this report code.</td></tr>');
			}
		}


		$(document).ready(function () {
			// Trigger data load when the dropdown changes
			$('#ReportCode').on('change', function () {
				const selectedReportCode = $(this).val();
				loadReportData(selectedReportCode);
			});

			// Optional: Load data if a report code is pre-selected on page load
			const initialReportCode = $('#ReportCode').val();
			if (initialReportCode) {
				loadReportData(initialReportCode);
			}
		});

	</script>

</head>
<title>BRRS</title>

<body>
	<div class="container-fluid">
		<div class="row">
			<div th:insert="HeaderMenu :: header"></div>
			<div class="col-sm-12">
				<!-- -------------------User List Starts----------------------------------------------------- -->


				<div style="padding-right: 0px;padding-left: 0px;" th:if="${formmode}=='list'">

					<div class="card" style="margin-left:10px;margin-right: 10px;">
						<div class="card-header"
							style="background-color: #376275; display: flex; align-items: center; justify-content: space-between; padding: 10px 20px;">

							<!-- Left: Back Icon + Title -->
							<div style="display: flex; align-items: center;" onclick="back();">
								<!-- Back Icon -->
								<div class="left-arrow-circle">
									<i class="fa fa-arrow-left"></i>
								</div>
								<!-- Dynamic Title -->
								<h5 th:text="${menu}"
									style="font-family: verdana; font-size: 20px; font-weight: bold; color: white; margin: 0 0 0 10px;">
								</h5>
							</div>

						</div>


						<div class="row formline">
							<div class="col-sm-1"></div>
						</div>
						<div class="row formline">
							<div class="col-sm-auto"></div>
							<label class="col-sm-auto">Report Code</label>
							<div class="col-sm-2">
								<select id="ReportCode" class="form-control form-control-sm" name="ReportCode"
									autocomplete="off" required>
									<option value="">Select</option>
									<option th:each="code : ${RptCodes}" th:value="${code}" th:text="${code}">
									</option>
								</select>
							</div>
						</div>



						<div class="row">
							<div class="col-12">
								<div class="table-container" style="max-height: 620px; overflow-y: auto;">
									<table class="table table-striped table-bordered table-hover" id="usertable">
										<thead class="thead-light"
											style="background-color:#e9ecf0; font-family: verdana; font-size: 14px;">
											<tr>

												<th style="text-align: left;">SRL_NO</th>
												<th style="text-align: left;">FIELD DESCRIPTION</th>
												<th style="text-align: left;">Report Label</th>
												<th style="text-align: left;">Header</th>
												<th style="text-align: left;">Remarks</th>
											</tr>
										</thead>
										<tbody>
											<!-- Data will be populated here by JavaScript -->
										</tbody>
									</table>
									<!-- Pagination Controls (remove if not needed with dynamic load) -->
									<div style="margin-top:20px; text-align:center;" th:if="${pagination=='YES'}">
										<a th:if="${currentPage > 0}"
											th:href="@{'/SourceDataMap'(formmode='list', page=${currentPage - 1}, size=100)}">
											Previous
										</a>

										<span>Page [[${currentPage + 1}]] of [[${totalPages}]]</span>

										<a th:if="${currentPage < totalPages - 1}"
											th:href="@{'/SourceDataMap'(formmode='list', page=${currentPage + 1}, size=100)}">
											Next
										</a>
									</div>
								</div>

								<div class="card-footer text-center">
									<button type="button" class="custom-tab-btn" id="btnHome"
										onclick="home();">Home</button>
									<button type="button" class="custom-tab-btn" id="btnBack"
										onclick="back();">Back</button>
								</div>
							</div>
						</div>

					</div>
				</div>

			</div>
			<div class="modal fade" id="alert">
				<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
					<div class="modal-content">
						<div class="modal-body" style="text-align: center">
							<p id="alertmsg"></p>
							<button type="button" class="btn btn-primary" data-bs-dismiss="modal"
								onclick="list()">Close</button>


						</div>
					</div>
				</div>
			</div>


			<div class="modal fade" id="datadelete">
				<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
					<div class="modal-content">
						<div class="modal-body" style="margin-top: 8px; text-align: center; color: #f15362;">
							<button type="button" class="close" data-dismiss="modal">×</button>
							Are you Sure want to delete?
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-primary" onclick="submitformdelete(this);"
								th:attr="data-formmode=delete">Submit</button>
							<button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>
						</div>
					</div>
				</div>
			</div>
			<div class="modal fade" id="formmsg">
				<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
					<div class="modal-content">
						<div class="modal-body" style="margin-top: 8px; text-align: center; color: aliceblue;">
							<button type="button" class="close" data-dismiss="modal">×</button>
							<a th:value="${msg}"></a>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-primary" onclick="submitformdelete(this);"
								th:attr="data-formmode=delete">Submit</button>
							<button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="alert" tabindex="-1" role="dialog" aria-hidden="true">
		<div class="modal-dialog modal-sm">
			<div class="modal-content">
				<div class="modal-body">
					<p id="alertmsg"></p>
					<div class="text-center">
						<button type="button" class="btn btn-primary btn-sm" data-dismiss="modal">OK</button>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>

<Script>
	function roledesc() {
		let workClass = document.getElementById("workClass").value;
		let permissionField = document.getElementById("permissions");

		if (workClass === "C") {
			permissionField.value = "R";
			permissionField.setAttribute("disabled", "disabled"); // Make read-only
		} else {
			permissionField.removeAttribute("disabled"); // Allow user to choose
			permissionField.value = ""; // Reset to default
		}
	}
</script>

<style>
	.left-arrow-circle {
		width: 35px;
		height: 35px;
		border-radius: 50%;
		background-color: white;
		display: flex;
		align-items: center;
		justify-content: center;
		margin-right: 10px;
		transition: background-color 0.3s, transform 0.2s;
	}

	.left-arrow-circle i {
		color: rgb(107, 122, 143);
		font-size: 16px;
	}

	.left-arrow-circle:hover {
		background-color: rgb(107, 122, 143);
		cursor: pointer;
		transform: scale(1.05);
		border: 2px solid white;
	}

	.left-arrow-circle:hover i {
		color: white;
	}
</style>

</html>